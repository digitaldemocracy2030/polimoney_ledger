import{a as t}from"./chunk-GUCFFKTL.js";import{a as r,b,e as w}from"./chunk-NJU4TC5B.js";import{d as h}from"./chunk-H4FMBZ3H.js";function C({journalId:o,readOnly:l=!1}){let[i,c]=r([]),[x,k]=r(!0),[y,g]=r(!1),[m,a]=r(null),[D,d]=r(!1),u=w(async()=>{try{let e=await fetch(`/api/journals/${o}/receipts`);if(!e.ok)throw new Error("\u9818\u53CE\u66F8\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F");let s=await e.json();c(s.data||[])}catch(e){console.error("Fetch receipts error:",e),a(e instanceof Error?e.message:"\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F")}finally{k(!1)}},[o]);b(()=>{u()},[u]);let v=async e=>{a(null),g(!0);try{let s=new FormData;s.append("file",e),s.append("journal_id",o);let n=await fetch("/api/receipts",{method:"POST",body:s});if(!n.ok){let f=await n.json();throw new Error(f.error||"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}let p=await n.json();c(f=>[p,...f])}catch(s){console.error("Upload error:",s),a(s instanceof Error?s.message:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}finally{g(!1)}},E=async e=>{if(confirm("\u3053\u306E\u9818\u53CE\u66F8\u3092\u524A\u9664\u3057\u307E\u3059\u304B\uFF1F"))try{let s=await fetch(`/api/receipts?id=${e}`,{method:"DELETE"});if(!s.ok){let n=await s.json();throw new Error(n.error||"\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}c(n=>n.filter(p=>p.id!==e))}catch(s){console.error("Delete error:",s),a(s instanceof Error?s.message:"\u524A\u9664\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}},j=e=>{let s=e.target,n=s.files;n&&n.length>0&&v(n[0]),s.value=""},F=e=>{e.preventDefault(),d(!0)},_=e=>{e.preventDefault(),d(!1)},L=e=>{e.preventDefault(),d(!1);let s=e.dataTransfer?.files;s&&s.length>0&&v(s[0])},R=e=>e===null?"-":e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`,B=e=>e.startsWith("image/")?"\u{1F5BC}\uFE0F":e==="application/pdf"?"\u{1F4C4}":"\u{1F4CE}";return x?t("div",{class:"flex items-center justify-center p-4",children:t("span",{class:"loading loading-spinner loading-md"})}):t("div",{class:"space-y-4",children:[m&&t("div",{class:"alert alert-error",children:[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),t("span",{children:m}),t("button",{class:"btn btn-ghost btn-sm",onClick:()=>a(null),children:"\u2715"})]}),!l&&t("div",{class:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${D?"border-primary bg-primary/10":"border-base-300 hover:border-primary/50"}`,onDragOver:F,onDragLeave:_,onDrop:L,children:y?t("div",{class:"flex flex-col items-center gap-2",children:[t("span",{class:"loading loading-spinner loading-lg"}),t("span",{class:"text-sm text-base-content/70",children:"\u30A2\u30C3\u30D7\u30ED\u30FC\u30C9\u4E2D..."})]}):t(h,{children:[t("div",{class:"text-4xl mb-2",children:"\u{1F4CE}"}),t("p",{class:"text-base-content/70 mb-2",children:"\u30D5\u30A1\u30A4\u30EB\u3092\u30C9\u30E9\u30C3\u30B0\uFF06\u30C9\u30ED\u30C3\u30D7"}),t("p",{class:"text-sm text-base-content/50 mb-4",children:"\u307E\u305F\u306F"}),t("label",{class:"btn btn-outline btn-primary",children:[t("input",{type:"file",class:"hidden",accept:"image/jpeg,image/png,image/gif,application/pdf",onChange:j}),"\u30D5\u30A1\u30A4\u30EB\u3092\u9078\u629E"]}),t("p",{class:"text-xs text-base-content/50 mt-3",children:"JPEG, PNG, GIF, PDF\uFF08\u6700\u59275MB\uFF09"})]})}),i.length>0?t("div",{class:"space-y-2",children:[t("h4",{class:"font-medium text-sm text-base-content/70",children:["\u6DFB\u4ED8\u30D5\u30A1\u30A4\u30EB (",i.length,")"]}),t("ul",{class:"divide-y divide-base-200",children:i.map(e=>t("li",{class:"py-2 flex items-center gap-3",children:[t("div",{class:"flex-shrink-0 w-12 h-12 bg-base-200 rounded flex items-center justify-center overflow-hidden",children:e.mime_type.startsWith("image/")&&e.url?t("img",{src:e.url,alt:e.file_name,class:"w-full h-full object-cover"}):t("span",{class:"text-2xl",children:B(e.mime_type)})}),t("div",{class:"flex-1 min-w-0",children:[t("p",{class:"text-sm font-medium truncate",children:e.file_name}),t("p",{class:"text-xs text-base-content/60",children:R(e.file_size)})]}),t("div",{class:"flex-shrink-0 flex gap-1",children:[e.url&&t("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",class:"btn btn-ghost btn-sm btn-square",title:"\u958B\u304F",children:t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4",children:t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})})}),!l&&t("button",{class:"btn btn-ghost btn-sm btn-square text-error",onClick:()=>E(e.id),title:"\u524A\u9664",children:t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4",children:t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})]})]},e.id))})]}):!l&&t("p",{class:"text-center text-sm text-base-content/50 py-4",children:"\u9818\u53CE\u66F8\u304C\u307E\u3060\u6DFB\u4ED8\u3055\u308C\u3066\u3044\u307E\u305B\u3093"})]})}export{C as default};
