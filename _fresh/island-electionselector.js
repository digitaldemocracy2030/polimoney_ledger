import{a as e}from"./chunk-GUCFFKTL.js";import{a as o,b as h,c as w}from"./chunk-NJU4TC5B.js";import"./chunk-H4FMBZ3H.js";var x={HR:"\u8846\u8B70\u9662\u8B70\u54E1\u9078\u6319",HC:"\u53C2\u8B70\u9662\u8B70\u54E1\u9078\u6319",PG:"\u90FD\u9053\u5E9C\u770C\u77E5\u4E8B\u9078\u6319",CM:"\u5E02\u533A\u753A\u6751\u9577\u9078\u6319",GM:"\u8B70\u4F1A\u8B70\u54E1\u9078\u6319"};function k({initialElections:d}){let[s]=o(d),[r,p]=o(""),[c,v]=o(""),[b,i]=o(!1),m=s.filter(a=>{let l=a.name.toLowerCase().includes(r.toLowerCase())||a.area_code.includes(r),t=!c||a.type===c;return l&&t}).reduce((a,l)=>{let t=new Date(l.election_date).getFullYear();return a[t]||(a[t]=[]),a[t].push(l),a},{}),u=Object.keys(m).map(Number).sort((a,l)=>l-a);return e("div",{children:[e("div",{class:"card bg-base-100 shadow-xl mb-6",children:e("div",{class:"card-body",children:e("div",{class:"flex flex-wrap gap-4",children:[e("div",{class:"form-control flex-1 min-w-[200px]",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u{1F50D} \u691C\u7D22"})}),e("input",{type:"text",value:r,onInput:a=>p(a.target.value),placeholder:"\u9078\u6319\u540D\u307E\u305F\u306F\u9078\u6319\u533A\u30B3\u30FC\u30C9\u3067\u691C\u7D22...",class:"input input-bordered w-full"})]}),e("div",{class:"form-control w-48",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u7A2E\u5225"})}),e("select",{value:c,onChange:a=>v(a.target.value),class:"select select-bordered w-full",children:[e("option",{value:"",children:"\u3059\u3079\u3066"}),Object.entries(x).map(([a,l])=>e("option",{value:a,children:l},a))]})]})]})})}),e("div",{class:"space-y-6",children:u.length>0?u.map(a=>e("div",{children:[e("h2",{class:"text-xl font-semibold mb-3 flex items-center",children:[e("span",{class:"mr-2",children:"\u{1F4C5}"}),a,"\u5E74"]}),e("div",{class:"card bg-base-100 shadow-xl",children:e("div",{class:"card-body p-0",children:e("ul",{class:"menu p-0",children:m[a].map(l=>e("li",{children:e("div",{class:"flex justify-between items-center py-4 px-6 border-b border-base-200 last:border-b-0",children:[e("div",{children:[e("h3",{class:"font-medium",children:l.name}),e("div",{class:"mt-1 flex flex-wrap items-center gap-2",children:[e("span",{class:"badge badge-info badge-sm",children:x[l.type]||l.type}),e("span",{class:"text-xs opacity-70",children:new Date(l.election_date).toLocaleDateString("ja-JP")}),e("span",{class:"text-xs opacity-70",children:["\u9078\u6319\u533A: ",l.area_code]})]})]}),e("a",{href:`/elections/${l.id}/ledger`,class:"btn btn-primary btn-sm",children:"\u53F0\u5E33\u3092\u958B\u304F"})]})},l.id))})})})]},a)):e("div",{class:"card bg-base-100 shadow-xl",children:e("div",{class:"card-body items-center text-center",children:e("p",{class:"text-base-content/70",children:"\u8A72\u5F53\u3059\u308B\u9078\u6319\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093"})})})}),e("div",{role:"alert",class:"alert alert-warning mt-8",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e("div",{children:[e("h3",{class:"font-bold",children:"\u8A72\u5F53\u3059\u308B\u9078\u6319\u304C\u306A\u3044\u5834\u5408"}),e("p",{class:"text-sm",children:"\u304A\u63A2\u3057\u306E\u9078\u6319\u304C\u898B\u3064\u304B\u3089\u306A\u3044\u5834\u5408\u306F\u3001\u767B\u9332\u3092\u30EA\u30AF\u30A8\u30B9\u30C8\u3067\u304D\u307E\u3059\u3002"})]}),e("button",{class:"btn btn-sm btn-warning",onClick:()=>i(!0),children:"\u767B\u9332\u3092\u30EA\u30AF\u30A8\u30B9\u30C8"})]}),b&&e(L,{onClose:()=>i(!1)})]})}function L({onClose:d}){let[s,r]=o({name:"",type:"GM",area_description:"",election_date:"",evidence_url:"",notes:"",requested_by_email:""}),[p,c]=o(!1),[v,b]=o(null),[i,f]=o(!1),m=w(null),u=w(null);h(()=>{let t=m.current;if(t){let n=g=>{let y=g.target;y.value&&(r(E=>({...E,election_date:y.value})),f(!1))};return t.addEventListener("change",n),()=>t.removeEventListener("change",n)}},[i]),h(()=>{if(!i)return;let t=n=>{u.current&&!u.current.contains(n.target)&&f(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[i]);let a=t=>t?new Date(t).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}):"\u65E5\u4ED8\u3092\u9078\u629E";return e("dialog",{class:"modal modal-open",children:[e("div",{class:"modal-box max-w-2xl",children:[e("form",{method:"dialog",children:e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",onClick:d,type:"button",children:"\u2715"})}),e("h3",{class:"font-bold text-lg mb-4",children:"\u9078\u6319\u306E\u767B\u9332\u30EA\u30AF\u30A8\u30B9\u30C8"}),v&&e("div",{role:"alert",class:"alert alert-error mb-4",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e("span",{children:v})]}),e("form",{onSubmit:async t=>{if(t.preventDefault(),c(!0),b(null),!s.election_date){b("\u9078\u6319\u65E5\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044"),c(!1);return}try{let n=await fetch("/api/election-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){let g=await n.json();throw new Error(g.error||"\u30EA\u30AF\u30A8\u30B9\u30C8\u306E\u9001\u4FE1\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}alert("\u767B\u9332\u30EA\u30AF\u30A8\u30B9\u30C8\u3092\u9001\u4FE1\u3057\u307E\u3057\u305F\u3002\u627F\u8A8D\u3055\u308C\u308B\u307E\u3067\u304A\u5F85\u3061\u304F\u3060\u3055\u3044\u3002"),d()}catch(n){b(n instanceof Error?n.message:"\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F")}finally{c(!1)}},class:"space-y-4",children:[e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u9078\u6319\u540D ",e("span",{class:"text-error",children:"*"})]})}),e("input",{type:"text",required:!0,value:s.name,onInput:t=>r({...s,name:t.target.value}),placeholder:"\u4F8B: 2025\u5E74\u3007\u3007\u5E02\u8B70\u4F1A\u8B70\u54E1\u9078\u6319",class:"input input-bordered w-full"})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u9078\u6319\u7A2E\u5225 ",e("span",{class:"text-error",children:"*"})]})}),e("select",{required:!0,value:s.type,onChange:t=>r({...s,type:t.target.value}),class:"select select-bordered w-full",children:Object.entries(x).map(([t,n])=>e("option",{value:t,children:n},t))})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u9078\u6319\u533A\u306E\u8AAC\u660E ",e("span",{class:"text-error",children:"*"})]})}),e("input",{type:"text",required:!0,value:s.area_description,onInput:t=>r({...s,area_description:t.target.value}),placeholder:"\u4F8B: \u6771\u4EAC\u90FD\u7B2C1\u533A\u3001\u3007\u3007\u5E02\u5168\u57DF",class:"input input-bordered w-full"})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u9078\u6319\u65E5\uFF08\u6295\u958B\u7968\u65E5\uFF09 ",e("span",{class:"text-error",children:"*"})]})}),e("div",{class:"relative",children:[e("button",{type:"button",onClick:()=>f(!i),class:"input input-bordered w-full text-left flex items-center justify-between",children:[e("span",{class:s.election_date?"":"text-base-content/50",children:a(s.election_date)}),e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 opacity-70",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})]}),i&&e("div",{ref:u,class:"absolute z-50 mt-1 bg-base-100 border border-base-300 shadow-lg rounded-box p-2",children:e("calendar-date",{ref:m,class:"cally",value:s.election_date,children:[e("svg",{"aria-label":"Previous",class:"fill-current size-4",slot:"previous",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e("path",{d:"M15.75 19.5 8.25 12l7.5-7.5"})}),e("svg",{"aria-label":"Next",class:"fill-current size-4",slot:"next",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e("path",{d:"m8.25 4.5 7.5 7.5-7.5 7.5"})}),e("calendar-month",{})]})})]})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u8A3C\u660EURL\uFF08\u9078\u7BA1\u30B5\u30A4\u30C8\u7B49\uFF09"})}),e("input",{type:"url",value:s.evidence_url,onInput:t=>r({...s,evidence_url:t.target.value}),placeholder:"https://...",class:"input input-bordered w-full"})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u9023\u7D61\u5148\u30E1\u30FC\u30EB\u30A2\u30C9\u30EC\u30B9"})}),e("input",{type:"email",value:s.requested_by_email,onInput:t=>r({...s,requested_by_email:t.target.value}),placeholder:"example@email.com",class:"input input-bordered w-full"})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u5099\u8003"})}),e("textarea",{value:s.notes,onInput:t=>r({...s,notes:t.target.value}),rows:3,class:"textarea textarea-bordered w-full"})]}),e("div",{class:"modal-action",children:[e("button",{type:"button",class:"btn btn-ghost",onClick:d,children:"\u30AD\u30E3\u30F3\u30BB\u30EB"}),e("button",{type:"submit",class:`btn btn-primary ${p?"loading":""}`,disabled:p,children:p?"\u9001\u4FE1\u4E2D...":"\u30EA\u30AF\u30A8\u30B9\u30C8\u3092\u9001\u4FE1"})]})]})]}),e("form",{method:"dialog",class:"modal-backdrop",children:e("button",{onClick:d,children:"close"})})]})}export{k as default};
