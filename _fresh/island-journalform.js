import{a as W}from"./chunk-C56BR5IP.js";import{a as e}from"./chunk-GUCFFKTL.js";import{a,b as G}from"./chunk-NJU4TC5B.js";import"./chunk-H4FMBZ3H.js";function le({ledgerType:g,organizationId:K,electionId:Q,accountCodes:y,contacts:U,subAccounts:V,onSuccess:M}){let[l,f]=a("expense"),[H,X]=a(new Date().toISOString().split("T")[0]),[L,I]=a(""),[x,w]=a(""),[Y,Z]=a(U),[h,C]=a(""),[ee,q]=a(!1),[o,d]=a(""),[s,p]=a(""),[j,r]=a(""),[_,c]=a(""),[T,N]=a("campaign"),[S,D]=a(""),[A,F]=a(""),[P,R]=a(""),[$,z]=a(""),[u,J]=a(!1),[O,B]=a(""),[E,v]=a(!1),[k,b]=a(null),m=y.filter(t=>t.type==="asset"),te=y.filter(t=>t.type==="expense"),ae=y.filter(t=>t.type==="revenue"||t.type==="equity");G(()=>{d(""),p(""),r(""),c("")},[l]);let i=t=>V.filter(n=>n.parent_account_code===t);return e("form",{onSubmit:async t=>{if(t.preventDefault(),v(!0),b(null),!o||!s){b({type:"error",text:"\u52D8\u5B9A\u79D1\u76EE\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),v(!1);return}if(l!=="transfer"&&!h){b({type:"error",text:"\u95A2\u4FC2\u8005\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),v(!1);return}try{let n=await fetch("/api/journals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organization_id:K,election_id:Q,journal_date:H,description:L,contact_id:l!=="transfer"?h:null,classification:g==="election"?T:null,non_monetary_basis:P||null,notes:$||null,amount_political_grant:S?Number(S):0,amount_political_fund:A?Number(A):0,is_receipt_hard_to_collect:u,receipt_hard_to_collect_reason:u?O:null,entries:[{account_code:o,sub_account_id:j||null,debit_amount:Number(x),credit_amount:0},{account_code:s,sub_account_id:_||null,debit_amount:0,credit_amount:Number(x)}]})});if(!n.ok){let se=await n.json();throw new Error(se.error||"\u767B\u9332\u306B\u5931\u6557\u3057\u307E\u3057\u305F")}b({type:"success",text:"\u4ED5\u8A33\u3092\u767B\u9332\u3057\u307E\u3057\u305F"}),I(""),w(""),C(""),d(""),p(""),r(""),c(""),R(""),z(""),D(""),F(""),J(!1),B(""),M?M():setTimeout(()=>{window.location.reload()},1e3)}catch(n){b({type:"error",text:n instanceof Error?n.message:"\u767B\u9332\u306B\u5931\u6557\u3057\u307E\u3057\u305F"})}finally{v(!1)}},class:"space-y-6",children:[e("div",{class:"flex gap-2",children:[e("button",{type:"button",class:`btn ${l==="expense"?"btn-error":"btn-outline"}`,onClick:()=>f("expense"),children:"\u652F\u51FA"}),e("button",{type:"button",class:`btn ${l==="revenue"?"btn-primary":"btn-outline"}`,onClick:()=>f("revenue"),children:"\u53CE\u5165"}),e("button",{type:"button",class:`btn ${l==="transfer"?"btn-secondary":"btn-outline"}`,onClick:()=>f("transfer"),children:"\u632F\u66FF"})]}),e("div",{class:"card bg-base-200",children:e("div",{class:"card-body",children:[e("h3",{class:"card-title text-base",children:"\u57FA\u672C\u60C5\u5831"}),e("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u65E5\u4ED8 ",e("span",{class:"text-error",children:"*"})]})}),e("input",{type:"date",class:"input input-bordered",value:H,onChange:t=>X(t.target.value),required:!0})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u91D1\u984D ",e("span",{class:"text-error",children:"*"})]})}),e("input",{type:"number",class:"input input-bordered",placeholder:"0",min:"0",value:x,onChange:t=>w(t.target.value),required:!0})]})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u6458\u8981 ",e("span",{class:"text-error",children:"*"})]})}),e("input",{type:"text",class:"input input-bordered",placeholder:"\u4F8B: \u4E8B\u52D9\u6240\u5BB6\u8CC3 5\u6708\u5206",value:L,onChange:t=>I(t.target.value),required:!0})]}),l!=="transfer"&&e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u95A2\u4FC2\u8005\uFF08\u652F\u6255\u5148\u30FB\u5BC4\u4ED8\u8005\u306A\u3069\uFF09 ",e("span",{class:"text-error",children:"*"})]})}),e("div",{class:"flex gap-2",children:[e("select",{class:"select select-bordered flex-1",value:h,onChange:t=>C(t.target.value),required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),Y.map(t=>e("option",{value:t.id,children:[t.name," ",t.contact_type==="corporation"?"\uFF08\u6CD5\u4EBA\uFF09":""]},t.id))]}),e("button",{type:"button",class:"btn btn-outline",onClick:()=>q(!0),title:"\u95A2\u4FC2\u8005\u3092\u8FFD\u52A0",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",class:"w-5 h-5",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]})]})]})}),e("div",{class:"card bg-base-200",children:e("div",{class:"card-body",children:[e("h3",{class:"card-title text-base",children:"\u52D8\u5B9A\u79D1\u76EE"}),l==="expense"&&e("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{class:"space-y-2",children:[e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u652F\u51FA\u79D1\u76EE\uFF08\u4F55\u306B\u4F7F\u3063\u305F\u304B\uFF09 ",e("span",{class:"text-error",children:"*"})]})}),e("select",{class:"select select-bordered",value:o,onChange:t=>{d(t.target.value),r("")},required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),te.map(t=>e("option",{value:t.code,children:t.name},t.code))]})]}),o&&i(o).length>0&&e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u88DC\u52A9\u79D1\u76EE"})}),e("select",{class:"select select-bordered select-sm",value:j,onChange:t=>r(t.target.value),children:[e("option",{value:"",children:"\uFF08\u306A\u3057\uFF09"}),i(o).map(t=>e("option",{value:t.id,children:t.name},t.id))]})]})]}),e("div",{class:"space-y-2",children:[e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u652F\u6255\u5143\uFF08\u3069\u306E\u8CC7\u7523\u304B\u3089\u6255\u3063\u305F\u304B\uFF09"," ",e("span",{class:"text-error",children:"*"})]})}),e("select",{class:"select select-bordered",value:s,onChange:t=>{p(t.target.value),c("")},required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),m.map(t=>e("option",{value:t.code,children:t.name},t.code))]})]}),s&&i(s).length>0&&e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u88DC\u52A9\u79D1\u76EE"})}),e("select",{class:"select select-bordered select-sm",value:_,onChange:t=>c(t.target.value),children:[e("option",{value:"",children:"\uFF08\u306A\u3057\uFF09"}),i(s).map(t=>e("option",{value:t.id,children:t.name},t.id))]})]})]})]}),l==="revenue"&&e("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{class:"space-y-2",children:e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u5165\u91D1\u5148\uFF08\u3069\u306E\u8CC7\u7523\u304C\u5897\u3048\u305F\u304B\uFF09"," ",e("span",{class:"text-error",children:"*"})]})}),e("select",{class:"select select-bordered",value:o,onChange:t=>{d(t.target.value),r("")},required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),m.map(t=>e("option",{value:t.code,children:t.name},t.code))]})]})}),e("div",{class:"space-y-2",children:[e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u53CE\u5165\u79D1\u76EE\uFF08\u4F55\u306B\u3088\u308B\u53CE\u5165\u304B\uFF09"," ",e("span",{class:"text-error",children:"*"})]})}),e("select",{class:"select select-bordered",value:s,onChange:t=>{p(t.target.value),c("")},required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),ae.map(t=>e("option",{value:t.code,children:t.name},t.code))]})]}),s&&i(s).length>0&&e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u88DC\u52A9\u79D1\u76EE"})}),e("select",{class:"select select-bordered select-sm",value:_,onChange:t=>c(t.target.value),children:[e("option",{value:"",children:"\uFF08\u306A\u3057\uFF09"}),i(s).map(t=>e("option",{value:t.id,children:t.name},t.id))]})]})]})]}),l==="transfer"&&e("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{class:"space-y-2",children:e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u632F\u66FF\u5143\uFF08\u3069\u306E\u8CC7\u7523\u304B\u3089\uFF09 ",e("span",{class:"text-error",children:"*"})]})}),e("select",{class:"select select-bordered",value:s,onChange:t=>{p(t.target.value),c("")},required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),m.map(t=>e("option",{value:t.code,children:t.name},t.code))]})]})}),e("div",{class:"space-y-2",children:e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u632F\u66FF\u5148\uFF08\u3069\u306E\u8CC7\u7523\u3078\uFF09 ",e("span",{class:"text-error",children:"*"})]})}),e("select",{class:"select select-bordered",value:o,onChange:t=>{d(t.target.value),r("")},required:!0,children:[e("option",{value:"",children:"\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044"}),m.map(t=>e("option",{value:t.code,children:t.name},t.code))]})]})})]})]})}),e("div",{class:"card bg-base-200",children:e("div",{class:"card-body",children:[e("h3",{class:"card-title text-base",children:"\u8FFD\u52A0\u60C5\u5831"}),g==="election"&&e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u6D3B\u52D5\u533A\u5206"})}),e("div",{class:"flex gap-4",children:[e("label",{class:"label cursor-pointer gap-2",children:[e("input",{type:"radio",name:"classification",class:"radio radio-primary",checked:T==="pre-campaign",onChange:()=>N("pre-campaign")}),e("span",{class:"label-text",children:"\u7ACB\u5019\u88DC\u6E96\u5099"})]}),e("label",{class:"label cursor-pointer gap-2",children:[e("input",{type:"radio",name:"classification",class:"radio radio-primary",checked:T==="campaign",onChange:()=>N("campaign")}),e("span",{class:"label-text",children:"\u9078\u6319\u904B\u52D5"})]})]})]}),g==="organization"&&e("div",{class:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u653F\u515A\u4EA4\u4ED8\u91D1\u5145\u5F53\u984D"})}),e("input",{type:"number",class:"input input-bordered",placeholder:"0",min:"0",value:S,onChange:t=>D(t.target.value)})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u653F\u515A\u57FA\u91D1\u5145\u5F53\u984D"})}),e("input",{type:"number",class:"input input-bordered",placeholder:"0",min:"0",value:A,onChange:t=>F(t.target.value)})]})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u91D1\u92AD\u4EE5\u5916\u306E\u898B\u7A4D\u306E\u6839\u62E0"})}),e("input",{type:"text",class:"input input-bordered",placeholder:"\u73FE\u7269\u5BC4\u4ED8\u7B49\u306E\u5834\u5408\u306B\u8A18\u5165",value:P,onChange:t=>R(t.target.value)})]}),e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:"\u5099\u8003"})}),e("textarea",{class:"textarea textarea-bordered",placeholder:"\u4EFB\u610F\u5165\u529B",rows:2,value:$,onChange:t=>z(t.target.value)})]}),e("div",{class:"form-control",children:e("label",{class:"label cursor-pointer justify-start gap-2",children:[e("input",{type:"checkbox",class:"checkbox",checked:u,onChange:t=>J(t.target.checked)}),e("span",{class:"label-text",children:"\u9818\u53CE\u8A3C\u3092\u5FB4\u3057\u96E3\u3044"}),e("span",{class:"label-text-alt text-base-content/60",children:"\uFF08\u81EA\u52D5\u8CA9\u58F2\u6A5F\u3067\u306E\u8CFC\u5165\u306A\u3069\uFF09"})]})}),u&&e("div",{class:"form-control",children:[e("label",{class:"label",children:e("span",{class:"label-text",children:["\u9818\u53CE\u8A3C\u3092\u5FB4\u3057\u96E3\u3044\u7406\u7531 ",e("span",{class:"text-error",children:"*"})]})}),e("input",{type:"text",class:"input input-bordered",placeholder:"\u4F8B: \u81EA\u52D5\u8CA9\u58F2\u6A5F\u3067\u306E\u8CFC\u5165\u306E\u305F\u3081",value:O,onChange:t=>B(t.target.value),required:u})]})]})}),k&&e("div",{class:`alert ${k.type==="success"?"alert-success":"alert-error"}`,children:e("span",{children:k.text})}),e("div",{class:"flex justify-end gap-2",children:e("button",{type:"submit",class:`btn btn-primary ${E?"loading":""}`,disabled:E,children:E?"\u767B\u9332\u4E2D...":"\u4ED5\u8A33\u3092\u767B\u9332"})}),e(W,{isOpen:ee,onClose:()=>q(!1),onSuccess:t=>{Z(n=>[...n,t]),C(t.id)}})]})}export{le as default};
